{"version":3,"file":"abstract-connector.esm.js","sources":["../src/index.ts"],"sourcesContent":["import {\r\n  ChainIdCallback,\r\n  ConnectCallback,\r\n  Connector,\r\n  DefaultConnectionPayload,\r\n  DisconnectCallback,\r\n  SubscribedObject,\r\n} from '@meta-wallets-kit/types';\r\nimport { getAccount, getChainId, SendingInterface } from '@meta-wallets-kit/utils';\r\n\r\nexport abstract class AbstractConnector<P extends DefaultConnectionPayload>\r\n  implements Connector<P> {\r\n  protected payload: P | null = null;\r\n  private sendingInterface: SendingInterface = 'EIP 1193';\r\n\r\n  public abstract connect(): Promise<P>;\r\n\r\n  public async disconnect() {\r\n    this.payload = null;\r\n  }\r\n\r\n  public async getAccount(): Promise<string | null> {\r\n    if (!this.payload) {\r\n      return null;\r\n    }\r\n\r\n    const { account, sendingInterface } = await getAccount(\r\n      this.payload.provider,\r\n      this.sendingInterface,\r\n    );\r\n\r\n    this.sendingInterface = sendingInterface;\r\n\r\n    return account;\r\n  }\r\n\r\n  public async getChainId(): Promise<number | null> {\r\n    if (!this.payload) {\r\n      return null;\r\n    }\r\n\r\n    const { chainId, sendingInterface } = await getChainId(\r\n      this.payload.provider,\r\n      this.sendingInterface,\r\n    );\r\n\r\n    this.sendingInterface = sendingInterface;\r\n\r\n    return chainId;\r\n  }\r\n\r\n  public getConnectionPayload() {\r\n    return this.payload;\r\n  }\r\n\r\n  public subscribeConnectAccount(callback: ConnectCallback): SubscribedObject {\r\n    const convertedCallback = (accounts: string[]) => callback(accounts[0]);\r\n\r\n    this.payload?.provider.on && this.payload.provider.on('accountsChanged', convertedCallback);\r\n\r\n    return {\r\n      unsubscribe: () => {\r\n        this.payload?.provider.removeListener &&\r\n          this.payload.provider.removeListener('accountsChanged', convertedCallback);\r\n      },\r\n    };\r\n  }\r\n\r\n  public subscribeChainId(callback: ChainIdCallback): SubscribedObject {\r\n    const convertedCallback = (chainId: number | string) => {\r\n      const convertedChainId = typeof chainId === 'string' ? parseInt(chainId, 16) : chainId;\r\n\r\n      if (Number.isNaN(convertedChainId)) {\r\n        throw new Error('ChainId is incorrect');\r\n      } else {\r\n        callback(convertedChainId);\r\n      }\r\n    };\r\n\r\n    this.payload?.provider.on && this.payload.provider.on('chainChanged', convertedCallback);\r\n\r\n    return {\r\n      unsubscribe: () => {\r\n        this.payload?.provider.removeListener &&\r\n          this.payload.provider.removeListener('chainChanged', convertedCallback);\r\n      },\r\n    };\r\n  }\r\n\r\n  public subscribeDisconnect(callback: DisconnectCallback): SubscribedObject {\r\n    this.payload?.provider.on && this.payload.provider.on('disconnect', callback);\r\n\r\n    return {\r\n      unsubscribe: () => {\r\n        this.payload?.provider.removeListener &&\r\n          this.payload.provider.removeListener('disconnect', callback);\r\n      },\r\n    };\r\n  }\r\n}\r\n"],"names":["AbstractConnector","_proto","prototype","disconnect","_disconnect","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","payload","stop","apply","arguments","getAccount","_getAccount2","_callee2","_yield$_getAccount","account","sendingInterface","_callee2$","_context2","abrupt","provider","sent","getChainId","_getChainId2","_callee3","_yield$_getChainId","chainId","_callee3$","_context3","getConnectionPayload","subscribeConnectAccount","callback","convertedCallback","accounts","_this$payload","on","unsubscribe","_this$payload2","_this","removeListener","subscribeChainId","convertedChainId","parseInt","Number","isNaN","Error","_this$payload3","_this2$payload","_this2","subscribeDisconnect","_this$payload4","_this3$payload","_this3"],"mappings":"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"}