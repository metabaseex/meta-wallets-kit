{"version":3,"file":"coinbase-connector.cjs.development.js","sources":["../src/index.ts"],"sourcesContent":["/* eslint-disable import/no-duplicates */\r\nimport type { CoinbaseWalletProvider } from '@coinbase/wallet-sdk';\r\nimport type CoinbaseWalletSDKClass from '@coinbase/wallet-sdk';\r\nimport { AbstractConnector } from '@meta-wallets-kit/abstract-connector';\r\nimport {\r\n  DefaultConnectionPayload,\r\n  DisconnectCallback,\r\n  SubscribedObject,\r\n} from '@meta-wallets-kit/types';\r\n\r\ntype CoinbaseWalletSDKOptions = ConstructorParameters<typeof CoinbaseWalletSDKClass>[0];\r\n\r\nexport interface CoinbaseConnectionPayload extends DefaultConnectionPayload {\r\n  provider: CoinbaseWalletProvider;\r\n  coinbase: CoinbaseWalletSDKClass;\r\n}\r\n\r\nexport interface CoinbaseConnectorConfig extends CoinbaseWalletSDKOptions {\r\n  jsonRpcUrl?: string;\r\n  chainId?: number;\r\n}\r\n\r\nexport class CoinbaseConnector extends AbstractConnector<CoinbaseConnectionPayload> {\r\n  constructor(private config: CoinbaseConnectorConfig) {\r\n    super();\r\n  }\r\n\r\n  public async connect(): Promise<CoinbaseConnectionPayload> {\r\n    const { jsonRpcUrl, chainId, ...ctorOptions } = this.config;\r\n\r\n    const CoinbaseWalletSDK = (await import('@coinbase/wallet-sdk')).default;\r\n    const coinbase = new CoinbaseWalletSDK(ctorOptions);\r\n\r\n    const provider = coinbase.makeWeb3Provider(jsonRpcUrl, chainId);\r\n    await provider.enable();\r\n\r\n    this.payload = { provider, coinbase };\r\n\r\n    return this.payload;\r\n  }\r\n\r\n  public async disconnect() {\r\n    if (this.payload) {\r\n      this.payload.coinbase.disconnect();\r\n    }\r\n    super.disconnect();\r\n  }\r\n\r\n  public subscribeDisconnect(callback: DisconnectCallback): SubscribedObject {\r\n    return super.subscribeDisconnect((error?: any) => {\r\n      const isRecoverableDisconnection = error?.code === 1013;\r\n      !isRecoverableDisconnection && callback(error);\r\n    });\r\n  }\r\n}\r\n"],"names":["CoinbaseConnector","_AbstractConnector","_inheritsLoose","config","_this","call","_proto","prototype","connect","_connect","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_this$config","jsonRpcUrl","chainId","ctorOptions","CoinbaseWalletSDK","coinbase","provider","wrap","_callee$","_context","prev","next","_objectWithoutPropertiesLoose","_excluded","sent","makeWeb3Provider","enable","payload","abrupt","stop","apply","arguments","disconnect","_disconnect","_callee2","_callee2$","_context2","subscribeDisconnect","callback","error","isRecoverableDisconnection","code","AbstractConnector"],"mappings":"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"}