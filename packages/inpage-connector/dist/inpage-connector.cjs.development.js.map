{"version":3,"file":"inpage-connector.cjs.development.js","sources":["../src/index.ts"],"sourcesContent":["import { AbstractConnector } from '@meta-wallets-kit/abstract-connector';\r\nimport {\r\n  DefaultConnectionPayload,\r\n  DisconnectCallback,\r\n  SubscribedObject,\r\n} from '@meta-wallets-kit/types';\r\n\r\nimport { InpageProvider } from './@types/extend-window';\r\n\r\nexport { InpageProvider };\r\n\r\nexport interface InpageConnectionPayload extends DefaultConnectionPayload {\r\n  provider: InpageProvider;\r\n}\r\n\r\nexport class InpageConnector extends AbstractConnector<InpageConnectionPayload> {\r\n  public async connect(): Promise<InpageConnectionPayload> {\r\n    let provider: InpageProvider = window.ethereum || window.web3?.currentProvider;\r\n\r\n    // edge case if Metamask and Coinbase extensions are both installed\r\n    if (Array.isArray(provider?.providers)) {\r\n      provider = provider.providers.find((x: InpageProvider) => x.isMetaMask) || provider;\r\n    }\r\n\r\n    if (!provider) {\r\n      throw new Error(\r\n        'Web3 provider not found! Please install the Web3 extension (e.g. Metamask) or use the Web3 browser (e.g. TrustWallet on your mobile device).',\r\n      );\r\n    }\r\n\r\n    if (provider.enable) {\r\n      await provider.enable();\r\n    }\r\n\r\n    this.payload = {\r\n      provider,\r\n    };\r\n\r\n    return this.payload;\r\n  }\r\n\r\n  public subscribeDisconnect(callback: DisconnectCallback): SubscribedObject {\r\n    return super.subscribeDisconnect((error?: any) => {\r\n      const isRecoverableMetamaskDisconnection =\r\n        this.payload?.provider?.isMetaMask && error?.code === 1013;\r\n      !isRecoverableMetamaskDisconnection && callback(error);\r\n    });\r\n  }\r\n}\r\n"],"names":["InpageConnector","_AbstractConnector","_inheritsLoose","apply","arguments","_proto","prototype","connect","_connect","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_window$web","_provider","provider","wrap","_callee$","_context","prev","next","window","ethereum","web3","currentProvider","Array","isArray","providers","find","x","isMetaMask","Error","enable","payload","abrupt","stop","subscribeDisconnect","callback","call","error","isRecoverableMetamaskDisconnection","_this$payload","_this","_this$payload$provide","code","AbstractConnector"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeaA,eAAgB,0BAAAC,kBAAA;EAAAC,cAAA,CAAAF,eAAA,EAAAC,kBAAA;EAAA,SAAAD;IAAA,OAAAC,kBAAA,CAAAE,KAAA,OAAAC,SAAA;;EAAA,IAAAC,MAAA,GAAAL,eAAA,CAAAM,SAAA;EAAAD,MAAA,CACdE,OAAO;IAAA,IAAAC,QAAA,gBAAAC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,CAAb,SAAAC;MAAA,IAAAC,WAAA,EAAAC,SAAA;MAAA,IAAAC,QAAA;MAAA,OAAAL,mBAAA,GAAAM,IAAA,UAAAC,SAAAC,QAAA;QAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;UAAA;YACDL,QAAQ,GAAmBM,MAAM,CAACC,QAAQ,MAAAT,WAAA,GAAIQ,MAAM,CAACE,IAAI,qBAAXV,WAAA,CAAaW,eAAe;YAG9E,IAAIC,KAAK,CAACC,OAAO,EAAAZ,SAAA,GAACC,QAAQ,qBAARD,SAAA,CAAUa,SAAS,CAAC,EAAE;cACtCZ,QAAQ,GAAGA,QAAQ,CAACY,SAAS,CAACC,IAAI,CAAC,UAACC,CAAiB;gBAAA,OAAKA,CAAC,CAACC,UAAU;gBAAC,IAAIf,QAAQ;;YACpF,IAEIA,QAAQ;cAAAG,QAAA,CAAAE,IAAA;cAAA;;YAAA,MACL,IAAIW,KAAK,CACb,8IAA8I,CAC/I;UAAA;YAAA,KAGChB,QAAQ,CAACiB,MAAM;cAAAd,QAAA,CAAAE,IAAA;cAAA;;YAAAF,QAAA,CAAAE,IAAA;YAAA,OACXL,QAAQ,CAACiB,MAAM,EAAE;UAAA;YAGzB,IAAI,CAACC,OAAO,GAAG;cACblB,QAAQ,EAARA;aACD;YAAC,OAAAG,QAAA,CAAAgB,MAAA,WAEK,IAAI,CAACD,OAAO;UAAA;UAAA;YAAA,OAAAf,QAAA,CAAAiB,IAAA;;SAAAvB,OAAA;KACpB;IAAA,SAAAL;MAAA,OAAAC,QAAA,CAAAL,KAAA,OAAAC,SAAA;;IAAA,OAAAG,OAAA;;EAAAF,MAAA,CAEM+B,mBAAmB,GAAnB,SAAAA,oBAAoBC,QAA4B;;IACrD,OAAApC,kBAAA,CAAAK,SAAA,CAAa8B,mBAAmB,CAAAE,IAAA,OAAC,UAACC,KAAW;;MAC3C,IAAMC,kCAAkC,GACtC,EAAAC,aAAA,GAAAC,KAAI,CAACT,OAAO,sBAAAU,qBAAA,GAAZF,aAAA,CAAc1B,QAAQ,qBAAtB4B,qBAAA,CAAwBb,UAAU,KAAI,CAAAS,KAAK,oBAALA,KAAK,CAAEK,IAAI,MAAK,IAAI;MAC5D,CAACJ,kCAAkC,IAAIH,QAAQ,CAACE,KAAK,CAAC;KACvD;GACF;EAAA,OAAAvC,eAAA;AAAA,EAhCkC6C,mCAA0C;;;;"}